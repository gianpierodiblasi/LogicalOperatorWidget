class LogicalCircuitCore{#a={};#b;#c=["OR","NOR","AND","NAND","XOR","NXOR","NOT","BREAK","CASE","CATCH","CLASS","CONST","CONTINUE","DEBUGGER","DEFAULT","DELETE","DO","ELSE","EXPORT","EXTENDS","FALSE","FINALLY","FOR","FUNCTION","IF","IMPORT","IN","INSTANCEOF","NEW","NULL","RETURN","SUPER","SWITCH","THIS","THROW","TRUE","TRY","TYPEOF","VAR","VOID","WHILE","WITH","LET","STATIC","YIELD","AWAIT","ENUM","IMPLEMENTS","INTERFACE","PACKAGE","PRIVATE","PROTECTED","PUBLIC","ABSTRACT","BOOLEAN","BYTE","CHAR","DOUBLE","FINAL","FLOAT","GOTO","INT","LONG","NATIVE","SHORT","SYNCHRONIZED","THROWS","TRANSIENT","VOLATILE","ARGUMENTS","AS","ASYNC","EVAL","FROM","GET","OF","SET"];#d=["OR","NOR","AND","NAND","XOR","NXOR","NOT"];#e={OR:"||",AND:"&&",XOR:"+",NOR:"||",NAND:"&&",NXOR:"+"};#f={OR:"",AND:"",XOR:"===1",NOR:"",NAND:"",NXOR:"!==1"};constructor(){}setJSON(t){this.#a=JSON.parse(JSON.stringify(t))}getJSON(){return JSON.parse(JSON.stringify(this.#a))}setSimplifier(t){this.#b=t}simplify(){if(!this.#b||!this.isValid())return!1;var t={};Object.keys(this.#a).filter(t=>"IN"===this.#a[t].type).forEach(e=>t[e]={type:"IN"});var e=!0;return Object.keys(this.#a).filter(t=>"OUT"===this.#a[t].type).forEach(s=>{var i=[];this.#g(s,i);for(var o=[],n=0;n<Math.pow(2,i.length);n++){var h={},r=n.toString(2).padStart(i.length,"0");i.forEach((t,e)=>h[t]=!!parseInt(r[e])),this.computeExpression(s,h)&&o.push(n)}t[s]={type:"OUT",from:[]};try{var a=this.#b(o);this.#h(t,s,i,a)}catch(l){e=!1}}),e&&(this.#a=t),e}#g(t,e){"IN"===this.#a[t].type?e.includes(t)||e.push(t):"NOT"===this.#a[t].type?this.#g(this.#a[t].from[0],e):this.#a[t].from.forEach(t=>this.#g(t,e))}#h(t,e,s,i){if(1===(i=i.split(" OR ")).length)this.#i(t,e,s,i[0]);else{var o=this.#j("OR");t[o]={type:"OR",from:[]},i.forEach(e=>this.#i(t,o,s,e)),t[e].from.push(o)}}#i(t,e,s,i){if(1===(i=i.replace("(","").replace(")","").split(" AND ")).length)this.#k(t,e,s,i[0]);else{var o=this.#j("AND");t[o]={type:"AND",from:[]},i.forEach(e=>this.#k(t,o,s,e)),t[e].from.push(o)}}#k(t,e,s,i){if(i.startsWith("NOT ")){var o=this.#j("NOT");t[o]={type:"NOT",from:[s[i.charCodeAt(4)-65]]},t[e].from.push(o)}else t[e].from.push(s[i.charCodeAt(0)-65])}computeExpressions(t){var e={};return this.isValid()&&Object.keys(this.#a).filter(t=>"OUT"===this.#a[t].type).forEach(s=>e[s]=this.computeExpression(s,t)),e}computeExpression(name,parameters){var result;if(this.isValid()&&this.#a[name]&&"OUT"===this.#a[name].type){var toEval=Object.keys(parameters).reduce((t,e)=>t+"var "+e+" = "+parameters[e]+";\n","");eval(toEval+="result = "+this.getJavaScriptExpression(name)+";")}return result}getJavaScriptExpressions(){var t={};return this.isValid()&&Object.keys(this.#a).filter(t=>"OUT"===this.#a[t].type).forEach(e=>t[e]=this.#l(this.#a[e].from[0],!1)),t}getJavaScriptExpression(t){return this.isValid()&&this.#a[t]&&"OUT"===this.#a[t].type?this.#l(this.#a[t].from[0],!1):""}#l(t,e){if("IN"===this.#a[t].type)return t;if("NOT"===this.#a[t].type)return"!"+this.#l(this.#a[t].from[0],!0);var s=this.#a[t].from.map(t=>this.#l(t,!0));switch(this.#a[t].type){case"OR":case"AND":case"XOR":case"NXOR":return(e?"(":"")+s.join(this.#e[this.#a[t].type])+this.#f[this.#a[t].type]+(e?")":"");case"NOR":case"NAND":return"!("+s.join(this.#e[this.#a[t].type])+")"}}isValid(){return Object.keys(this.#a).filter(t=>"OUT"===this.#a[t].type).reduce((t,e)=>t&&this.#m(e),!0)}#m(t){var e=!0;return this.#a[t].from.forEach(t=>{(e&=!!t)&&"IN"!==this.#a[t].type&&(e&=!!this.#m(t))}),!!e}isEmpty(){return!Object.keys(this.#a).length}addInput(t){return this.#n(t,{type:"IN"})}addOutput(t){return this.#n(t,{type:"OUT",from:[""]})}addOR(){return this.#o("OR",["",""])}addNOR(){return this.#o("NOR",["",""])}addAND(){return this.#o("AND",["",""])}addNAND(){return this.#o("NAND",["",""])}addXOR(){return this.#o("XOR",["",""])}addNXOR(){return this.#o("NXOR",["",""])}addNOT(){return this.#o("NOT",[""])}#o(t,e){var s=this.#j(t);return this.#n(s,{type:t,from:e},!0),s}#n(t,e,s){return s?(this.#a[t]=e,!0):!!this.isNameValid(t)&&!this.isNameAlreadyUsed(t)&&(this.#a[t]=e,!0)}#j(t){return"$_"+t.padEnd(5,"_")+new Date().getTime()+"_"+parseInt(1e4*Math.random()).toFixed(0).padStart(4,"0")}incConnector(t){this.#a[t]&&!["IN","OUT","NOT"].includes(this.#a[t].type)&&this.#a[t].from.push("")}decConnector(t){if(this.#a[t]&&!["IN","OUT","NOT"].includes(this.#a[t].type)&&this.#a[t].from.length>2){var e=this.#a[t].from.indexOf("");-1!==e?this.#a[t].from.splice(e,1):this.#a[t].from.pop()}}addConnection(t,e,s){this.isConnectionValid(t,e)&&0<=s&&s<this.#a[e].from.length&&(this.#a[e].from[s]=t)}isConnectionValid(t,e){if(t===e||!this.#a[t]||!this.#a[e])return!1;if("IN"===this.#a[t].type)return"IN"!==this.#a[e].type;if("OUT"===this.#a[t].type)return!1;if("IN"===this.#a[e].type)return!1;if("OUT"===this.#a[e].type)return!0;else return!this.#p(t,e)}#p(t,e){var s=Object.keys(this.#a).filter(t=>this.#d.includes(this.#a[t].type)&&this.#a[t].from.includes(e));return s.includes(t)||s.reduce((e,s)=>e||this.#p(t,s),!1)}removeConnection(t,e){this.#a[t]&&this.#a[t].from&&0<=e&&e<this.#a[t].from.length&&(this.#a[t].from[e]="")}remove(t){this.#a[t]&&(delete this.#a[t],Object.keys(this.#a).filter(t=>"IN"!==this.#a[t].type).forEach(e=>this.#a[e].from=this.#a[e].from.map(e=>e===t?"":e)))}clear(){this.#a={}}getType(t){return this.#a[t]?this.#a[t].type:""}getFrom(t){return this.#a[t]&&"IN"!==this.#a[t].type?this.#a[t].from.slice():[]}isNameValid(t){return"string"==typeof t&&/^[a-z]+[a-z0-9_]*$/i.test(t)&&!this.#c.includes(t.toUpperCase())}isNameAlreadyUsed(t){return!!this.#a[t]}addBlackListWord(t){t&&this.#c.push(t.toUpperCase())}}var uniqueDragAndDropKeyLogicalCircuitUI="";class LogicalCircuitUI{#q;#r=new LogicalCircuitCore;#s={};#t={width:800,height:600,font:"24px sans-serif",lineWidth:2,strokeStyle:"black",fillStyle:"black",cursor:"default",bezierConnector:!1,showOperatorType:!1,interactive:!1};#u={index:0,array:[{json:"{}",jsonUI:"{}"}]};#v={en:{simplifyLabel:"Simplify",reorganizeLabel:"Reorganize",dndTooltip:"Click or Drag&Drop to add a new element",trashTooltip:"To trash an element move and release it here",undoTooltip:"Undo",redoTooltip:"Redo",clearTooltip:"Clear",clearMessage:"Do you really want to clear the current logical circuit?",simplifyMessage:"Do you really want to simplify the current logical circuit?",reorganizeMessage:"Do you really want to reorganize the current logical circuit?"},it:{simplifyLabel:"Semplifica",reorganizeLabel:"Riorganizza",dndTooltip:"Clicca o Trascina&Rilascia per aggiungere un nuovo elemento",trashTooltip:"Per eliminare un elemento muovilo e rilascialo qui",undoTooltip:"Annulla",redoTooltip:"Ripeti",clearTooltip:"Cancella",clearMessage:"Vuoi realmente cancellare il circuito logico corrente?",simplifyMessage:"Vuoi realmente semplificare il circuito logico corrente?",reorganizeMessage:"Vuoi realmente riorganizzare il circuito logico corrente?"}};#w={classId:"",droppable:!1,inTrash:!1,left:0,top:0};#x=[];#y=[];#z;#A;constructor(t,e){this.#q="LogicalCircuitUI_Container_"+new Date().getTime()+"_"+parseInt(1e3*Math.random());try{e.width}catch(s){e={}}this.#t.width=isNaN(e.width)||e.width<0?this.#t.width:e.width,this.#t.height=isNaN(e.height)||e.height<0?this.#t.height:e.height,e.lang&&this.#v[e.lang]?this.#v=this.#v[e.lang]:this.#v[navigator.language.substring(0,2)]?this.#v=this.#v[navigator.language.substring(0,2)]:this.#v=this.#v.en,t.classList.add("LogicalCircuitUI_Container"),t.classList.add(this.#q),t.style.width=this.#t.width+2+"px",this.#A=new LogicalCircuitToolbar(t,this.#q,this.#r,this.#s,this.#t,this.#u,this.#v,this.#w,this.#x,this.#y),this.#z=new LogicalCircuitCanvas(t,this.#q,this.#r,this.#s,this.#t,this.#u,this.#v,this.#w,this.#x,this.#y),this.#A.setCanvas(this.#z),this.#z.setToolbar(this.#A),this.setBezierConnector(e.bezierConnector),this.setShowOperatorType(e.showOperatorType),this.setInteractive(e.interactive)}setJSONs(t,e){this.#u.index=0,this.#u.array=[{json:JSON.stringify(t),jsonUI:JSON.stringify(e)}],this.#r.setJSON(t),Object.keys(this.#s).forEach(t=>delete this.#s[t]),Object.assign(this.#s,e),this.#A.setJSONUI(),this.#z.setJSONUI(),this.#x.forEach(t=>t()),this.#y.forEach(t=>t())}getJSON(){return this.#r.getJSON()}getJSONUI(){return JSON.parse(JSON.stringify(this.#s))}setSimplifier(t){this.#r.setSimplifier(t),this.#A.setSimplifierVisible(!!t)}setReorganizer(t){this.#A.setReorganizer(t)}computeExpressions(t){return this.#r.computeExpressions(t)}computeExpression(t,e){return this.#r.computeExpression(t,e)}getJavaScriptExpressions(){return this.#r.getJavaScriptExpressions()}getJavaScriptExpression(t){return this.#r.getJavaScriptExpression(t)}isValid(){return this.#r.isValid()}setBezierConnector(t){this.#z.setBezierConnector(!!t)}setShowOperatorType(t){this.#z.setShowOperatorType(!!t)}setInteractive(t){this.#z.setInteractive(!!t)}addOnChangeListener(t){this.#x.push(t)}addOnChangeUIListener(t){this.#y.push(t)}addBlackListWord(t){this.#r.addBlackListWord(t)}}class LogicalCircuitToolbar{#q;#r;#s;#t;#u;#v;#w;#x=[];#y=[];#z;#B;#C={top:15,left:15};constructor(t,e,s,i,o,n,h,r,a,l){this.#q=e,this.#r=s,this.#s=i,this.#t=o,this.#u=n,this.#v=h,this.#w=r,this.#x=a,this.#y=l;var c=document.createElement("div");c.classList.add("LogicalCircuitUI_Toolbar"),c.style.width=this.#t.width+2+"px",t.append(c),this.#D(c,"↶",null,this.#v.undoTooltip,null,"UNDO",null,()=>this.#E(),null,null,"small",!0,!0,!1),this.#D(c,"↷",null,this.#v.redoTooltip,null,"REDO",null,()=>this.#F(),null,null,"small",!0,!0,!1),this.#D(c,"\uD83D\uDDD1",null,this.#v.clearTooltip,null,"CLEAR",null,()=>this.#G(),null,"Divide_On_Right","small",!0,!0,!1),this.#H(c),this.#I(c,"OR"),this.#I(c,"AND"),this.#I(c,"XOR"),this.#D(c,"NOT",null,this.#v.dndTooltip,null,"NOT",null,()=>this.#n("NOT"),null,"Divide_On_Right","medium",!1,!0,!0),this.#D(c,this.#v.simplifyLabel,this.#v.reorganizeLabel,null,null,"SIMPLIFY","REORGANIZE",()=>this.#J(),()=>this.#K(),null,"large",!0,!1,!1)}#I(t,e){this.#D(t,e,"N"+e,this.#v.dndTooltip,this.#v.dndTooltip,e,"N"+e,()=>this.#n(e),()=>this.#n("N"+e),null,"medium",!1,!0,!0)}#D(s,i,o,n,h,r,a,l,c,u,d,f,m,p){var g=document.createElement("div");g.classList.add("LogicalCircuitUI_Toolbar_ButtonContainer"),u&&g.classList.add(u),s.append(g),l&&(this.#L(g,i,n,r,d,f,m,p).onclick=t=>l()),c&&(this.#L(g,o,h,a,d,f,m,p).onclick=t=>c())}#H(v){var b=document.createElement("div");b.classList.add("LogicalCircuitUI_Toolbar_TextContainer"),b.classList.add("Divide_On_Right"),v.append(b);var y=document.createElement("input");y.type="text",y.classList.add("IN-OUT"),y.oninput=t=>{var e=!this.#r.isNameValid(y.value)||this.#r.isNameAlreadyUsed(y.value);I.disabled=e,I.setAttribute("draggable",!e),N.disabled=e,N.setAttribute("draggable",!e)},b.append(y);var I=this.#L(b,"IN",this.#v.dndTooltip,"IN","medium",!0,!0,!1),N=this.#L(b,"OUT",this.#v.dndTooltip,"OUT","medium",!0,!0,!1);I.onclick=t=>this.#M(y.value),N.onclick=t=>this.#N(y.value)}#L(T,x,O,C,S,$,w,U){var P=document.createElement("button");return P.textContent=x,P.title=O||"",P.classList.add(C),P.classList.add(S),P.disabled=$,P.style.visibility=w?"visible":"hidden",P.setAttribute("draggable",U),P.ondragstart=t=>this.#O(t,C),P.ondragend=t=>this.#P(t),T.append(P),P}#O(k,j){uniqueDragAndDropKeyLogicalCircuitUI=this.#q,this.#w.classId=j,this.#w.droppable=!1,k.dataTransfer.effectAllowed="move",k.dataTransfer.setDragImage(this.#z.getCanvasForDnD(j,document.querySelector("."+this.#q+" input.IN-OUT").value),5,5)}#P(D){if(this.#w.droppable&&!this.#w.inTrash)switch(this.#w.classId){case"IN":this.#M(document.querySelector("."+this.#q+" input.IN-OUT").value,this.#w.left,this.#w.top);break;case"OUT":this.#N(document.querySelector("."+this.#q+" input.IN-OUT").value,this.#w.left,this.#w.top);break;default:this.#n(this.#w.classId,this.#w.left,this.#w.top)}uniqueDragAndDropKeyLogicalCircuitUI="",this.#w.classId="",this.#w.droppable=!1}#E(){this.#u.index--,this.#r.setJSON(JSON.parse(this.#u.array[this.#u.index].json)),Object.keys(this.#s).forEach(t=>delete this.#s[t]),Object.assign(this.#s,JSON.parse(this.#u.array[this.#u.index].jsonUI)),this.setJSONUI(),this.#z.setJSONUI(),this.#x.forEach(t=>t()),this.#y.forEach(t=>t())}#F(){this.#u.index++,this.#r.setJSON(JSON.parse(this.#u.array[this.#u.index].json)),Object.keys(this.#s).forEach(t=>delete this.#s[t]),Object.assign(this.#s,JSON.parse(this.#u.array[this.#u.index].jsonUI)),this.setJSONUI(),this.#z.setJSONUI(),this.#x.forEach(t=>t()),this.#y.forEach(t=>t())}#G(){confirm(this.#v.clearMessage)&&(this.#u.index=0,this.#u.array=[{json:"{}",jsonUI:"{}"}],this.#r.clear(),Object.keys(this.#s).forEach(t=>delete this.#s[t]),this.setJSONUI(),this.#z.setJSONUI(),this.#x.forEach(t=>t()),this.#y.forEach(t=>t()))}#M(E,L,R){this.#r.addInput(E),this.#Q(E,L,R),this.#R(),this.setJSONUI(),this.#z.setInteractiveValue(E,!1),this.#x.forEach(t=>t()),this.#y.forEach(t=>t())}#N(M,A,_){this.#r.addOutput(M),this.#Q(M,A,_),this.#R(),this.setJSONUI(),this.#z.draw(),this.#x.forEach(t=>t()),this.#y.forEach(t=>t())}#n(K,z,V){var X=this.#r["add"+K]();this.#Q(X,z,V),this.#R(),this.setJSONUI(),this.#z.draw(),this.#x.forEach(t=>t()),this.#y.forEach(t=>t())}#Q(q,B,W){this.#s[q]={top:W||this.#C.top,left:B||this.#C.left}}#J(){if(confirm(this.#v.simplifyMessage)&&this.#r.simplify()){var H=this.#r.getJSON();Object.keys(this.#s).forEach(t=>delete this.#s[t]),Object.keys(H).filter(t=>"IN"===this.#r.getType(t)).forEach((t,e,s)=>this.#z.assignPosition(t,e,s,this.#C.left)),Object.keys(H).filter(t=>"NOT"===this.#r.getType(t)).forEach((t,e,s)=>this.#z.assignPosition(t,e,s,this.#t.width/5)),Object.keys(H).filter(t=>"AND"===this.#r.getType(t)).forEach((t,e,s)=>this.#z.assignPosition(t,e,s,2*this.#t.width/5)),Object.keys(H).filter(t=>"OR"===this.#r.getType(t)).forEach((t,e,s)=>this.#z.assignPosition(t,e,s,3*this.#t.width/5)),Object.keys(H).filter(t=>"OUT"===this.#r.getType(t)).forEach((t,e,s)=>this.#z.assignPosition(t,e,s,4*this.#t.width/5));try{this.#z.draw();var F=[];Object.keys(this.#s).filter(t=>"IN"!==this.#r.getType(t)).forEach(t=>this.#r.getFrom(t).forEach(e=>F.push({from:e,to:t})));var J=this.#B(this.#z.getSymbolSize(),F,this.#t.width,this.#t.height);Object.assign(this.#s,J),this.#z.draw()}catch(Y){}this.#R(),this.resetButtons(),this.#x.forEach(t=>t()),this.#y.forEach(t=>t())}}#K(){if(confirm(this.#v.reorganizeMessage))try{var G=[];Object.keys(this.#s).filter(t=>"IN"!==this.#r.getType(t)).forEach(t=>this.#r.getFrom(t).forEach(e=>G.push({from:e,to:t})));var Z=this.#B(this.#z.getSymbolSize(),G,this.#t.width,this.#t.height);Object.keys(this.#s).forEach(t=>delete this.#s[t]),Object.assign(this.#s,Z),this.#R(),this.resetButtons(),this.#z.draw(),this.#y.forEach(t=>t())}catch(Q){}}#R(){this.#u.array.splice(this.#u.index+1),this.#u.index++,this.#u.array.push({json:JSON.stringify(this.#r.getJSON()),jsonUI:JSON.stringify(this.#s)})}setCanvas(t){this.#z=t}setJSONUI(){this.resetButtons(),this.#S()}resetButtons(){var t=this.#r.isEmpty()||!this.#r.isValid();document.querySelector("."+this.#q+" button.UNDO").disabled=0===this.#u.index,document.querySelector("."+this.#q+" button.REDO").disabled=this.#u.index===this.#u.array.length-1,document.querySelector("."+this.#q+" button.CLEAR").disabled=this.#r.isEmpty(),document.querySelector("."+this.#q+" button.SIMPLIFY").disabled=t,document.querySelector("."+this.#q+" button.REORGANIZE").disabled=t}#S(){document.querySelector("."+this.#q+" input.IN-OUT").value="",document.querySelector("."+this.#q+" button.IN").disabled=!0,document.querySelector("."+this.#q+" button.OUT").disabled=!0}setSimplifierVisible(t){document.querySelector("."+this.#q+" button.SIMPLIFY").style.visibility=t?"visible":"hidden"}setReorganizer(t){this.#B=t,document.querySelector("."+this.#q+" button.REORGANIZE").style.visibility=t?"visible":"hidden"}}class LogicalCircuitCanvas{#q;#r;#s;#t;#u;#v;#w;#x=[];#y=[];#A;#z;#T;#U;#V={selected:!1};#W={};#X={};#Y={};#Z={};#$={};#_={};#aa={};#ab;#ac={font:"48px sans-serif",text:"\uD83D\uDDD1",strokeStyle:"red",left:35,top:20,lineWidth:80,radius1:40,radius2:120,gradients:[{pos:0,color:"rgba(0,0,0,0)"},{pos:.5,color:"rgba(0,0,0,0)"},{pos:1,color:"rgba(0,0,0,0.3)"}]};#ad={gap:20,height:40,ONStyle:"green",OFFStyle:"gray",circleStyle:"white"};#ae={radiusLeft:20,lineWidth:30,oneHeight:20,xorGap:12,notRadius:7,font:"9px sans-serif"};#af={pressed:!1,name:"",index:-1,referenceName:"",event:null,canDoStrokeStyle:"green",cannotDoStrokeStyle:"orange",lineWidth:3,radius:5};#ag={grab:"grab",pointer:"pointer",notAllowed:"not-allowed",grabbing:"grabbing"};#ah={name:"",index:-1,referencePath:"",referenceName:"",lineWidth:3,strokeStyle:"green"};#ai={pressed:!1,name:"",offsetLeft:0,offsetTop:0};#aj={selected:!1,name:"",direction:"",font:"14px sans-serif",up:"-",down:"+",max:6,canDoFillStyle:"white",cannotDoFillStyle:"gray"};constructor(t,e,s,i,o,n,h,r,a,l){this.#q=e,this.#r=s,this.#s=i,this.#t=o,this.#u=n,this.#v=h,this.#w=r,this.#x=a,this.#y=l,this.#z=document.createElement("canvas"),this.#z.classList.add("LogicalCircuitUI_Canvas"),this.#z.width=this.#t.width,this.#z.height=this.#t.height,this.#z.onmousemove=t=>this.#ak(t),this.#z.onmousedown=t=>this.#al(t),this.#z.onmouseup=t=>this.#am(t),this.#z.ondragenter=t=>this.#an(t),this.#z.ondragover=t=>this.#ao(t),this.#z.ondragleave=t=>this.#ap(t),t.append(this.#z),this.#U=this.#z.getContext("2d"),this.#U.font=this.#t.font,this.#U.textBaseline="middle",this.#U.lineWidth=this.#t.lineWidth,this.#U.lineJoin="round",this.draw(),this.#T=document.createElement("canvas"),this.#T.classList.add("LogicalCircuitUI_CanvasDnD"),t.append(this.#T)}setToolbar(t){this.#A=t}setJSONUI(){this.setInteractive(this.#t.interactive)}setBezierConnector(t){this.#t.bezierConnector=t,this.draw()}setShowOperatorType(t){this.#t.showOperatorType=t,this.draw()}setInteractive(t){this.#t.interactive=!!t,this.#V.selected=!1,this.#W={},t&&Object.keys(this.#s).filter(t=>"IN"===this.#r.getType(t)).forEach(t=>this.#W[t]=!1),this.draw()}setInteractiveValue(t,e){this.#t.interactive&&(this.#W[t]=e),this.draw()}getSymbolSize(){return Object.keys(this.#_).filter(t=>!this.#s[t]).forEach(t=>delete this.#_[t]),JSON.parse(JSON.stringify(this.#_))}assignPosition(t,e,s,i){this.#s[t]={top:(e+1)*this.#z.height/(s.length+1)-this.#ad.height,left:i}}draw(){this.#z.style.cursor=this.#t.cursor,this.#U.clearRect(0,0,this.#z.width,this.#z.height),this.#aq(),Object.keys(this.#s).forEach(t=>{var e=this.#r.getType(t);switch(e){case"IN":this.#ar(t,"exit");break;case"OUT":this.#ar(t,"0");break;default:this.#as(t,e)}}),Object.keys(this.#s).forEach(t=>{"IN"===this.#r.getType(t)||this.#r.getFrom(t).forEach((e,s)=>this.#at(e,t,s))}),this.#au(),this.#av()}#aq(){this.#U.font=this.#ac.font,this.#U.fillText(this.#ac.text,this.#z.width-this.#ac.left,this.#z.height-this.#ac.top),this.#U.font=this.#t.font;var t=this.#U.createRadialGradient(this.#z.width,this.#z.height,this.#ac.radius1,this.#z.width,this.#z.height,this.#ac.radius2);this.#ac.gradients.forEach(e=>t.addColorStop(e.pos,e.color)),this.#U.lineWidth=this.#ac.lineWidth,this.#U.strokeStyle=t,this.#U.beginPath(),this.#U.arc(this.#z.width,this.#z.height,this.#ac.lineWidth,0,2*Math.PI),this.#U.stroke(),this.#U.lineWidth=this.#t.lineWidth,this.#U.strokeStyle=this.#t.strokeStyle}#ar(e,s){var i=this.#U.measureText(e).width+this.#ad.gap+(this.#t.interactive?this.#ad.gap:0),o=this.#s[e].top+this.#ad.height/2;if(this.#Z[e+"*"+s]={left:this.#s[e].left+("exit"===s?i+this.#af.radius:-this.#af.radius),top:o},this.#aw(e+"*"+s),this.#_[e]={width:i,height:this.#ad.height},this.#$[e]=new Path2D,this.#$[e].rect(this.#s[e].left,this.#s[e].top,i,this.#ad.height),this.#U.stroke(this.#$[e]),this.#t.interactive){n="exit"===s?this.#W[e]?this.#ad.ONStyle:this.#ad.OFFStyle:this.#r.isValid()?this.#r.computeExpression(e,this.#W)?this.#ad.ONStyle:this.#ad.OFFStyle:this.#ad.circleStyle;var n,h=this.#ad.gap/2-2,r=n===this.#ad.ONStyle?this.#s[e].top+2+h+2:this.#s[e].top+this.#ad.height-2-h-2,a=new Path2D;a.roundRect(this.#s[e].left+i-this.#ad.gap-2,this.#s[e].top+2,this.#ad.gap,this.#ad.height-4,this.#ad.gap/2),"exit"===s&&(this.#X[e]=a),this.#U.fillStyle=n,this.#U.fill(a),this.#U.fillStyle=this.#ad.circleStyle,this.#U.beginPath(),this.#U.arc(this.#s[e].left+i-this.#ad.gap/2-2,r,h,0,2*Math.PI),this.#U.fill(),this.#U.fillStyle=this.#t.fillStyle}this.#U.fillText(e,this.#s[e].left+this.#ad.gap/2,this.#Z[e+"*"+s].top)}#as(l,c){this.#$[l]=new Path2D;var u=this.#r.getFrom(l),d=this.#ae.oneHeight*u.length/2,f=this.#s[l].left+this.#ae.lineWidth+("NOT"===c?this.#ae.radiusLeft:0),m=this.#s[l].top+this.#ae.oneHeight*("NOT"===c?2:u.length),p=this.#s[l].top+("NOT"===c?this.#ae.oneHeight:d);this.#ax(l,c,f,p),this.#ay(l,c,u,p,d),this.#az(l,c,u,f,p),this.#aA(l,c,f,m,p,d),this.#aB(l,c)}#ax(g,v,b,y){switch(v){case"OR":case"AND":case"XOR":this.#Z[g+"*exit"]={left:b+this.#ae.radiusLeft+this.#af.radius,top:y};break;case"NOR":case"NAND":case"NXOR":this.#Z[g+"*exit"]={left:b+this.#ae.radiusLeft+2*this.#ae.notRadius+this.#af.radius,top:y};break;case"NOT":this.#Z[g+"*exit"]={left:b+2*this.#ae.notRadius+this.#af.radius,top:y}}this.#aw(g+"*exit")}#ay(I,N,T,x,O){for(var C=Math.PI/(T.length+1),S=0;S<T.length;S++){switch(N){case"OR":case"NOR":var $=C*(S+1)-Math.PI/2;this.#Z[I+"*"+S]={left:this.#s[I].left+(this.#ae.radiusLeft-this.#af.radius)*Math.cos($),top:x+(O-this.#af.radius)*Math.sin($)};break;case"AND":case"NAND":this.#Z[I+"*"+S]={left:this.#s[I].left-this.#af.radius,top:this.#s[I].top+this.#ae.oneHeight/2+this.#ae.oneHeight*S};break;case"XOR":case"NXOR":var $=C*(S+1)-Math.PI/2;this.#Z[I+"*"+S]={left:this.#s[I].left+(this.#ae.radiusLeft-this.#af.radius)*Math.cos($)-this.#ae.xorGap,top:x+(O-this.#af.radius)*Math.sin($)};break;case"NOT":this.#Z[I+"*"+S]={left:this.#s[I].left-this.#af.radius,top:x}}this.#aw(I+"*"+S)}}#az(w,U,P,k,j){switch(U){case"OR":case"AND":case"XOR":this.#_[w]={width:this.#ae.lineWidth+this.#ae.radiusLeft,height:this.#ae.oneHeight*P.length};break;case"NOR":case"NAND":case"NXOR":var D=new Path2D;D.arc(k+this.#ae.radiusLeft+this.#ae.notRadius,j,this.#ae.notRadius,0,2*Math.PI),this.#$[w].addPath(D),this.#_[w]={width:this.#ae.lineWidth+this.#ae.radiusLeft+2*this.#ae.notRadius,height:this.#ae.oneHeight*P.length};break;case"NOT":var D=new Path2D;D.arc(k+this.#ae.notRadius,j,this.#ae.notRadius,0,2*Math.PI),this.#$[w].addPath(D),this.#_[w]={width:this.#ae.lineWidth+this.#ae.radiusLeft+2*this.#ae.notRadius,height:2*this.#ae.oneHeight}}}#aA(E,L,R,M,A,_){switch("NOT"!==L&&(this.#$[E].moveTo(R,M),this.#$[E].lineTo(this.#s[E].left,M)),L){case"OR":case"NOR":this.#$[E].ellipse(this.#s[E].left,A,this.#ae.radiusLeft,_,0,Math.PI/2,-Math.PI/2,!0),this.#$[E].lineTo(R,this.#s[E].top),this.#$[E].quadraticCurveTo(R+3*this.#ae.radiusLeft/5,this.#s[E].top,R+this.#ae.radiusLeft,A),this.#$[E].quadraticCurveTo(R+3*this.#ae.radiusLeft/5,M,R,M);break;case"AND":case"NAND":this.#$[E].lineTo(this.#s[E].left,this.#s[E].top),this.#$[E].lineTo(R,this.#s[E].top),this.#$[E].ellipse(R,A,this.#ae.radiusLeft,_,0,-Math.PI/2,Math.PI/2);break;case"XOR":case"NXOR":this.#$[E].ellipse(this.#s[E].left,A,this.#ae.radiusLeft,_,0,Math.PI/2,-Math.PI/2,!0),this.#$[E].lineTo(R,this.#s[E].top),this.#$[E].ellipse(R,A,this.#ae.radiusLeft,_,0,-Math.PI/2,Math.PI/2);var K=new Path2D;K.ellipse(this.#s[E].left-this.#ae.xorGap,A,this.#ae.radiusLeft,_,0,Math.PI/2,-Math.PI/2,!0),this.#$[E].addPath(K);break;case"NOT":this.#$[E].moveTo(this.#s[E].left,this.#s[E].top),this.#$[E].lineTo(R,A),this.#$[E].lineTo(this.#s[E].left,M),this.#$[E].closePath()}this.#U.stroke(this.#$[E])}#aB(z,V){if(this.#t.showOperatorType){var X;switch(this.#U.font=this.#ae.font,V){case"OR":case"XOR":X=this.#ae.radiusLeft+(this.#_[z].width-this.#ae.radiusLeft-this.#U.measureText(V).width)/2;break;case"AND":X=(this.#_[z].width-this.#U.measureText(V).width)/2;break;case"NOR":case"NXOR":X=this.#ae.radiusLeft+(this.#_[z].width-this.#ae.radiusLeft-this.#U.measureText(V).width)/2-this.#ae.notRadius;break;case"NAND":X=(this.#_[z].width-this.#U.measureText(V).width)/2-this.#ae.notRadius;break;case"NOT":X=(this.#_[z].width-this.#U.measureText(V).width)/4}this.#U.fillText(V,this.#s[z].left+X,this.#s[z].top+this.#_[z].height/2),this.#U.font=this.#t.font}}#aw(q){this.#Y[q]=new Path2D,this.#Y[q].moveTo(this.#Z[q].left,this.#Z[q].top-this.#af.radius),this.#Y[q].lineTo(this.#Z[q].left+this.#af.radius,this.#Z[q].top),this.#Y[q].lineTo(this.#Z[q].left,this.#Z[q].top+this.#af.radius),this.#Y[q].lineTo(this.#Z[q].left-this.#af.radius,this.#Z[q].top),this.#Y[q].closePath(),this.#U.stroke(this.#Y[q])}#at(B,W,H){if(B){if(this.#aa[W+"*"+H]=new Path2D,this.#aa[W+"*"+H].moveTo(this.#Z[B+"*exit"].left,this.#Z[B+"*exit"].top),this.#t.bezierConnector){var F={left:this.#Z[B+"*exit"].left+(this.#Z[W+"*"+H].left-this.#Z[B+"*exit"].left)/2,top:this.#Z[B+"*exit"].top},J={left:F.left,top:this.#Z[W+"*"+H].top};this.#aa[W+"*"+H].bezierCurveTo(F.left,F.top,J.left,J.top,this.#Z[W+"*"+H].left,this.#Z[W+"*"+H].top)}else this.#aa[W+"*"+H].lineTo(this.#Z[W+"*"+H].left,this.#Z[W+"*"+H].top);this.#U.stroke(this.#aa[W+"*"+H])}}#au(){if(this.#ah.name){var Y=this.#r.getType(this.#ah.name);"symbolPath"!==this.#ah.referencePath||(this.#t.interactive&&"IN"===Y?(this.#V.selected=this.#U.isPointInPath(this.#X[this.#ah.name],this.#ab.offsetX,this.#ab.offsetY),this.#z.style.cursor=this.#V.selected?this.#ag.pointer:this.#ag.grab):["IN","OUT","NOT"].includes(Y)?this.#z.style.cursor=this.#ag.grab:this.#aC()),this.#aD()}}#aC(){var G=this.#s[this.#ah.name].left+3*this.#_[this.#ah.name].width/5;switch(this.#r.getType(this.#ah.name)){case"OR":case"AND":case"XOR":break;case"NOR":case"NAND":case"NXOR":G-=this.#ae.notRadius}var Z=this.#r.getFrom(this.#ah.name).length,Q=this.#s[this.#ah.name].top+this.#_[this.#ah.name].height/4,tt=this.#s[this.#ah.name].top+3*this.#_[this.#ah.name].height/4;this.#U.font=this.#aj.font;var te=this.#U.measureText(this.#aj.up).width,ts=this.#U.measureText(this.#aj.down).width,ti=Math.max(te,ts),to=new Path2D,tn=new Path2D;this.#U.fillStyle=Z>2?this.#aj.canDoFillStyle:this.#aj.cannotDoFillStyle,tn.rect(G-2,this.#s[this.#ah.name].top+3,ti+4,this.#_[this.#ah.name].height/2-3),to.addPath(tn),this.#U.fill(tn),this.#U.stroke(tn),tn=new Path2D,this.#U.fillStyle=Z<this.#aj.max?this.#aj.canDoFillStyle:this.#aj.cannotDoFillStyle,tn.rect(G-2,this.#s[this.#ah.name].top+this.#_[this.#ah.name].height/2,ti+4,this.#_[this.#ah.name].height/2-3),to.addPath(tn),this.#U.fill(tn),this.#U.stroke(tn),this.#U.fillStyle=this.#t.fillStyle,this.#U.fillText(this.#aj.up,G+(ti-te)/2,Q),this.#U.fillText(this.#aj.down,G+(ti-ts)/2,tt),this.#U.font=this.#t.font,this.#aj.selected=this.#U.isPointInPath(to,this.#ab.offsetX,this.#ab.offsetY),this.#aj.name=this.#ah.name,this.#aj.direction=this.#ab.offsetY<this.#s[this.#ah.name].top+this.#_[this.#ah.name].height/2?"UP":"DOWN",this.#aj.selected?"UP"===this.#aj.direction&&Z>2?this.#z.style.cursor=this.#ag.pointer:"DOWN"===this.#aj.direction&&Z<this.#aj.max?this.#z.style.cursor=this.#ag.pointer:this.#z.style.cursor=this.#ag.notAllowed:this.#z.style.cursor=this.#ag.grab}#aD(){this.#U.lineWidth=this.#ah.lineWidth,this.#ai.pressed?(this.#z.style.cursor=this.#ag.grabbing,this.#U.strokeStyle=this.#aE(this.#z.width,this.#z.height,this.#ac.lineWidth,this.#s[this.#ah.name].left,this.#s[this.#ah.name].top,this.#_[this.#ah.name].width,this.#_[this.#ah.name].height)?this.#ac.strokeStyle:this.#ah.strokeStyle):this.#U.strokeStyle="connectorPath"===this.#ah.referencePath?this.#ac.strokeStyle:this.#ah.strokeStyle,this.#U.stroke(this.#aF(this.#ah.referencePath,this.#ah.referenceName)),this.#U.lineWidth=this.#t.lineWidth,this.#U.strokeStyle=this.#t.strokeStyle}#aE(th,tr,ta,tl,tc,tu,td){var tf=th,tm=tr;th<tl?tf=tl:th>tl+tu&&(tf=tl+tu),tr<tc?tm=tc:tr>tc+td&&(tm=tc+td);var tp=th-tf,tg=tr-tm;return Math.sqrt(tp*tp+tg*tg)<=ta}#aF(tv,tb){switch(tv){case"symbolPath":return this.#$[tb];case"knobPath":return this.#Y[tb];case"connectorPath":return this.#aa[tb]}}#av(){if(this.#af.pressed){if(this.#U.beginPath(),this.#U.moveTo(this.#af.event.offsetX,this.#af.event.offsetY),this.#t.bezierConnector){var ty={left:this.#af.event.offsetX+(this.#ab.offsetX-this.#af.event.offsetX)/2,top:this.#af.event.offsetY},tI={left:ty.left,top:this.#ab.offsetY};this.#U.bezierCurveTo(ty.left,ty.top,tI.left,tI.top,this.#ab.offsetX,this.#ab.offsetY)}else this.#U.lineTo(this.#ab.offsetX,this.#ab.offsetY);this.#U.stroke(),this.#af.name&&(this.#U.lineWidth=this.#af.lineWidth,this.#U.strokeStyle=this.#aG(this.#ah.name,this.#ah.index,this.#af.name,this.#af.index)?this.#af.canDoStrokeStyle:this.#af.cannotDoStrokeStyle,this.#U.stroke(this.#Y[this.#af.referenceName]),this.#U.lineWidth=this.#t.lineWidth,this.#U.strokeStyle=this.#t.strokeStyle)}}#ak(tN){this.#ab=tN;var tT=Math.sqrt(Math.pow(tN.offsetX-this.#z.width,2)+Math.pow(tN.offsetY-this.#z.height,2));this.#z.setAttribute("title",tT<this.#ac.radius2?this.#v.trashTooltip:""),this.#ai.pressed?(this.#s[this.#ah.name].top=tN.offsetY-this.#ai.offsetTop,this.#s[this.#ah.name].left=tN.offsetX-this.#ai.offsetLeft):this.#af.pressed?this.#aH(tN):this.#aI(tN),this.draw()}#aH(tx){this.#af.name="",Object.keys(this.#s).forEach(t=>{switch(this.#r.getType(t)){case"IN":!this.#af.name&&this.#U.isPointInPath(this.#Y[t+"*exit"],tx.offsetX,tx.offsetY)&&(this.#af.name=t,this.#af.index=-1,this.#af.referenceName=t+"*exit");break;case"OUT":this.#r.getFrom(t).forEach((e,s)=>{!this.#af.name&&this.#U.isPointInPath(this.#Y[t+"*"+s],tx.offsetX,tx.offsetY)&&(this.#af.name=t,this.#af.index=s,this.#af.referenceName=t+"*"+s)});break;default:!this.#af.name&&this.#U.isPointInPath(this.#Y[t+"*exit"],tx.offsetX,tx.offsetY)&&(this.#af.name=t,this.#af.index=-1,this.#af.referenceName=t+"*exit"),this.#r.getFrom(t).forEach((e,s)=>{!this.#af.name&&this.#U.isPointInPath(this.#Y[t+"*"+s],tx.offsetX,tx.offsetY)&&(this.#af.name=t,this.#af.index=s,this.#af.referenceName=t+"*"+s)})}})}#aI(tO){this.#ah.name="",Object.keys(this.#s).forEach(t=>{switch(this.#r.getType(t)){case"IN":!this.#ah.name&&this.#U.isPointInPath(this.#Y[t+"*exit"],tO.offsetX,tO.offsetY)&&(this.#ah.name=t,this.#ah.index=-1,this.#ah.referencePath="knobPath",this.#ah.referenceName=t+"*exit");break;case"OUT":!this.#ah.name&&this.#U.isPointInPath(this.#Y[t+"*0"],tO.offsetX,tO.offsetY)&&(this.#ah.name=t,this.#ah.index=0,this.#ah.referencePath="knobPath",this.#ah.referenceName=t+"*0"),!this.#ah.name&&this.#r.getFrom(t)[0]&&this.#U.isPointInStroke(this.#aa[t+"*0"],tO.offsetX,tO.offsetY)&&(this.#ah.name=t,this.#ah.index=0,this.#ah.referencePath="connectorPath",this.#ah.referenceName=t+"*0");break;default:!this.#ah.name&&this.#U.isPointInPath(this.#Y[t+"*exit"],tO.offsetX,tO.offsetY)&&(this.#ah.name=t,this.#ah.index=-1,this.#ah.referencePath="knobPath",this.#ah.referenceName=t+"*exit"),this.#r.getFrom(t).forEach((e,s)=>{!this.#ah.name&&this.#U.isPointInPath(this.#Y[t+"*"+s],tO.offsetX,tO.offsetY)&&(this.#ah.name=t,this.#ah.index=s,this.#ah.referencePath="knobPath",this.#ah.referenceName=t+"*"+s),!this.#ah.name&&e&&this.#U.isPointInStroke(this.#aa[t+"*"+s],tO.offsetX,tO.offsetY)&&(this.#ah.name=t,this.#ah.index=s,this.#ah.referencePath="connectorPath",this.#ah.referenceName=t+"*"+s)})}!this.#ah.name&&this.#U.isPointInPath(this.#$[t],tO.offsetX,tO.offsetY)&&(this.#ah.name=t,this.#ah.referencePath="symbolPath",this.#ah.referenceName=t)})}#al(tC){if(this.#ah.name)switch(this.#ah.referencePath){case"knobPath":this.#af.pressed=!0,this.#af.event=tC;break;case"symbolPath":if(this.#aj.selected){var tS=!1,t$=this.#r.getFrom(this.#aj.name).length;switch(this.#aj.direction){case"UP":t$>2&&(tS=!0,this.#r.decConnector(this.#aj.name),this.#s[this.#aj.name].top+=this.#ae.oneHeight/2);break;case"DOWN":t$<this.#aj.max&&(tS=!0,this.#r.incConnector(this.#aj.name),this.#s[this.#aj.name].top-=this.#ae.oneHeight/2)}tS&&(this.#R(),this.#A.resetButtons(),this.draw(),this.#x.forEach(t=>t()),this.#y.forEach(t=>t()))}else this.#V.selected?(this.#W[this.#ah.name]=!this.#W[this.#ah.name],this.draw()):(this.#ai.pressed=!0,this.#ai.offsetLeft=tC.offsetX-this.#s[this.#ah.name].left,this.#ai.offsetTop=tC.offsetY-this.#s[this.#ah.name].top,this.#z.style.cursor=this.#ag.grabbing);break;case"connectorPath":this.#r.removeConnection(this.#ah.name,this.#ah.index),this.#ah.name="",this.#R(),this.#A.resetButtons(),this.draw(),this.#x.forEach(t=>t()),this.#y.forEach(t=>t())}}#am(tw){if(this.#ah.name&&this.#ai.pressed){var tU=!1;this.#aE(this.#z.width,this.#z.height,this.#ac.lineWidth,this.#s[this.#ah.name].left,this.#s[this.#ah.name].top,this.#_[this.#ah.name].width,this.#_[this.#ah.name].height)&&(tU=!0,this.#r.remove(this.#ah.name),delete this.#s[this.#ah.name],this.#ah.name=""),this.#R(),this.#A.resetButtons(),this.draw(),tU&&this.#x.forEach(t=>t()),this.#y.forEach(t=>t())}else if(this.#af.pressed&&this.#af.name&&this.#aG(this.#ah.name,this.#ah.index,this.#af.name,this.#af.index)){var tP=this.#r.getType(this.#ah.name),tk=this.#r.getType(this.#af.name);"IN"===tP?this.#r.addConnection(this.#ah.name,this.#af.name,this.#af.index):"IN"===tk?this.#r.addConnection(this.#af.name,this.#ah.name,this.#ah.index):"OUT"===tP?this.#r.addConnection(this.#af.name,this.#ah.name,0):"OUT"===tk?this.#r.addConnection(this.#ah.name,this.#af.name,0):-1===this.#ah.index?this.#r.addConnection(this.#ah.name,this.#af.name,this.#af.index):-1===this.#af.index&&this.#r.addConnection(this.#af.name,this.#ah.name,this.#ah.index),this.#R(),this.#A.resetButtons(),this.draw(),this.#x.forEach(t=>t()),this.#y.forEach(t=>t())}this.#af.pressed=!1,this.#ai.pressed=!1,this.#aj.selected=!1}#R(){this.#u.array.splice(this.#u.index+1),this.#u.index++,this.#u.array.push({json:JSON.stringify(this.#r.getJSON()),jsonUI:JSON.stringify(this.#s)})}#aG(tj,tD,tE,tL){var tR=this.#r.getType(tj),tM=this.#r.getType(tE);if("IN"===tR&&"IN"===tM)return!1;if("IN"===tR&&"OUT"===tM)return this.#r.isConnectionValid(tj,tE);if("IN"===tR)return -1!==tL&&this.#r.isConnectionValid(tj,tE);if("OUT"===tR&&"IN"===tM)return this.#r.isConnectionValid(tE,tj);if("OUT"===tR&&"OUT"===tM)return!1;else if("OUT"===tR)return -1===tL&&this.#r.isConnectionValid(tE,tj);else if("IN"===tM)return -1!==tD&&this.#r.isConnectionValid(tE,tj);else if("OUT"===tM)return -1===tD&&this.#r.isConnectionValid(tj,tE);else if(-1===tD&&-1===tL)return!1;else if(-1!==tD&&-1!==tL)return!1;else if(-1===tD)return this.#r.isConnectionValid(tj,tE);else if(-1===tL)return this.#r.isConnectionValid(tE,tj);else return!1}#an(tA){this.#aJ(tA)}#ao(t_){this.#aJ(t_)}#aJ(t0){t0.preventDefault();var tK=Math.sqrt(Math.pow(t0.offsetX-this.#z.width,2)+Math.pow(t0.offsetY-this.#z.height,2));this.#w.droppable=uniqueDragAndDropKeyLogicalCircuitUI===this.#q,this.#w.inTrash=tK<this.#ac.radius2,this.#w.left=t0.offsetX,this.#w.top=t0.offsetY,t0.dataTransfer.dropEffect=this.#w.droppable&&!this.#w.inTrash?"move":"none"}#ap(tz){tz.preventDefault(),this.#w.droppable=!1}getCanvasForDnD(t,e){var s,i=new Path2D,o=this.#T.getContext("2d");switch(t){case"IN":case"OUT":s={width:this.#U.measureText(e).width+this.#ad.gap+(this.#t.interactive?this.#ad.gap:0),height:this.#ad.height},i.rect(0,0,s.width,this.#ad.height),this.#T.width=s.width+10,this.#T.height=s.height+10,o.clearRect(0,0,this.#T.width,this.#T.height),o.translate(5,5),o.lineWidth=this.#t.lineWidth,o.lineJoin="round",o.stroke(i),o.font=this.#t.font,o.textBaseline="middle",o.fillText(e,this.#ad.gap/2,this.#ad.height/2);break;default:var n=this.#ae.lineWidth+("NOT"===t?this.#ae.radiusLeft:0);switch(s={height:2*this.#ae.oneHeight},t){case"OR":case"AND":case"XOR":s.width=this.#ae.lineWidth+this.#ae.radiusLeft;break;case"NOR":case"NAND":case"NXOR":var h=new Path2D;h.arc(n+this.#ae.radiusLeft+this.#ae.notRadius,this.#ae.oneHeight,this.#ae.notRadius,0,2*Math.PI),i.addPath(h),s.width=this.#ae.lineWidth+this.#ae.radiusLeft+2*this.#ae.notRadius;break;case"NOT":var h=new Path2D;h.arc(n+this.#ae.notRadius,this.#ae.oneHeight,this.#ae.notRadius,0,2*Math.PI),i.addPath(h),s.width=this.#ae.lineWidth+this.#ae.radiusLeft+2*this.#ae.notRadius}switch("NOT"!==t&&(i.moveTo(n,s.height),i.lineTo(0,s.height)),t){case"OR":case"NOR":i.ellipse(0,this.#ae.oneHeight,this.#ae.radiusLeft,this.#ae.oneHeight,0,Math.PI/2,-Math.PI/2,!0),i.lineTo(n,0),i.quadraticCurveTo(n+3*this.#ae.radiusLeft/5,0,n+this.#ae.radiusLeft,this.#ae.oneHeight),i.quadraticCurveTo(n+3*this.#ae.radiusLeft/5,s.height,n,s.height);break;case"AND":case"NAND":i.lineTo(0,0),i.lineTo(n,0),i.ellipse(n,this.#ae.oneHeight,this.#ae.radiusLeft,this.#ae.oneHeight,0,-Math.PI/2,Math.PI/2);break;case"XOR":case"NXOR":i.ellipse(0,this.#ae.oneHeight,this.#ae.radiusLeft,this.#ae.oneHeight,0,Math.PI/2,-Math.PI/2,!0),i.lineTo(n,0),i.ellipse(n,this.#ae.oneHeight,this.#ae.radiusLeft,this.#ae.oneHeight,0,-Math.PI/2,Math.PI/2);var r=new Path2D;r.ellipse(0-this.#ae.xorGap,this.#ae.oneHeight,this.#ae.radiusLeft,this.#ae.oneHeight,0,Math.PI/2,-Math.PI/2,!0),i.addPath(r);break;case"NOT":i.moveTo(0,0),i.lineTo(n,this.#ae.oneHeight),i.lineTo(0,s.height),i.closePath()}this.#T.width=s.width+10,this.#T.height=s.height+10,o.clearRect(0,0,this.#T.width,this.#T.height),o.lineWidth=this.#t.lineWidth,o.lineJoin="round",o.translate(5,5),o.stroke(i)}return this.#T}}class ProductTerm{static identity=new ProductTerm(0,0,[]);value;mask;numLiterals;variableNames;numVars;coverCount;constructor(t,e,s){this.value=t,this.mask=e,this.numLiterals=this.countBits(e),this.variableNames=s,this.numVars=s.length,this.coverCount=0}getValue(){return this.value}getMask(){return this.mask}getVariableNames(){return this.variableNames}isMinterm(){return this.numLiterals===this.numVars}incrementCoverCount(){++this.coverCount}getCoverCount(){return this.coverCount}reduces(t){if(t.mask===this.mask){if(0===this.mask)return identity;var e=t.value&this.mask^this.value&this.mask;if(1===this.countBits(e))return new ProductTerm(~e&this.value,~e&this.mask,this.variableNames)}return null}covers(t){return(this.value&this.mask)==(t.getValue()&this.mask)}countBits(t){for(var e=0,s=0;s<32;++s)(t&1<<s)!=0&&++e;return e}compareTo(t){return this.coverCount-t.coverCount}equals(t){return this.value===t.getValue()&&this.mask===t.getMask()}ptString(){if(0===this.mask)return"1";for(var t=[],e=0;e<this.numVars;++e)(this.mask&1<<e)!=0&&((this.value&1<<e)==0?t.push("NOT "+this.variableNames[e]):t.push(this.variableNames[e]));return"("+t.join(" AND ")+")"}toString(){return this.ptString()}}class PrimeImplicant extends ProductTerm{coversArray=[];constructor(t){super(t.getValue(),t.getMask(),t.getVariableNames())}addCover(t){if(t.isMinterm()){if(this.covers(t))this.coversArray.push(t);else throw"Attempt to add "+t.toString()+" to the list of minterms covered by prime implicant "+super.toString()+", but "+t.toString()+" is not covered by "+super.toString()}else throw"Attempt to add "+t.toString()+" to the list of minterms covered by prime implicant "+super.toString()+", but "+t.toString()+" is not a minterm."}compareTo(t){return t.coversArray.length-this.coversArray.length}toString(){for(var t="[ "+super.toString()+": ",e=0;e<this.coversArray.length;++e)t+=this.coversArray.elementAt(e),e<this.coversArray.length-1&&(t+=", ");return t+" ]"}}class TruthTable{numVars=0;numRows=0;numMinterms=0;variableNames=null;namesReversed;normalized="Not Given";theTable=null;mintermMask;minterms=null;constructor(t){if(this.numMinterms=t.length,0===this.numMinterms)this.numVars=0,this.numRows=0,this.variableNames=[],this.namesReversed=this.variableNames,this.normalized="",this.theTable=[],this.mintermMask=0,this.minterms=[];else{t.sort((t,e)=>t-e);var e,s=t[this.numMinterms-1];s<0&&(s=0);var i=this.leftBit(s);for(i<0&&(i=0),this.numRows=Math.pow(2,i+1),this.mintermMask=this.numRows-1,this.numVars=Math.ceil(Math.log(this.numRows)/Math.log(2)),this.variableNames=Array(this.numVars),e=0;e<this.numVars;++e)this.variableNames[e]=String.fromCharCode(65+e);for(e=0,this.namesReversed=Array(this.numVars);e<this.numVars;++e)this.namesReversed[e]=this.variableNames[this.numVars-e-1];for(e=0,this.theTable=Array(this.numRows).fill(!1),this.minterms=Array(this.numMinterms);e<this.numMinterms;++e)this.theTable[t[e]]=!0,this.minterms[e]=new ProductTerm(this.reverseBits(t[e],this.numVars),this.mintermMask,this.variableNames)}}leftBit(t){for(var e=31;e>=0;--e)if((t&1<<e)!=0)return e;return -1}reverseBits(t,e){for(var s=1<<e-1,i=1,o=t&~(Math.pow(2,e)-1),n=0;n<e;++n)(t&s)!=0&&(o|=i),s>>=1,i<<=1;return o}toString(){var1="[";for(var t=0;t<this.minterms.length;++t)var1+=this.reverseBits(this.minterms[t].value,this.numVars)+",";return 0===this.minterms.length?var1+="]":var1=var1.substring(0,var1.length-1)+"]",var1}}class QuineMcCluskey extends TruthTable{numLevels;levelTerms;primeImplicants;minimum;timesCovered;findAll;constructor(t,e){super(t),this.numLevels=this.numVars+1,this.levelTerms=Array(this.numLevels),this.findAll=!0,this.initialize(e)}initialize(t){this.levelTerms[0]=[];for(var e=0;e<this.numMinterms;++e)this.levelTerms[0].push(this.minterms[e]);var s=null,i=null,o=null,n=0;if(this.numVars>0)label126:for(n=1;n<this.numLevels;++n){var h=0;this.levelTerms[n]=[];var r=this.levelTerms[n-1].slice().reverse();label123:for(;r.length;)for(var s=r.pop(),a=!1,l=this.levelTerms[n-1].slice().reverse();;){do{if(!l.length){!a&&(this.levelTerms[n].push(s),t&&console.log("Unable to reduce "+s.toString()+" in pass "+n.toString()));continue label123}o=(i=l.pop()).reduces(s)}while(null===o);++h,t&&console.log("("+i.toString()+" + "+s.toString()+") can be replaced with "+o.toString()+" in pass "+n.toString()+": ");for(var c=!1,u=this.levelTerms[n].slice().reverse();u.length;)if(o.equals(u.pop())){t&&console.log("Not done. (Already included.)"),c=!0;break}if(!c&&(t&&console.log("Done."),this.levelTerms[n].push(o),ProductTerm.identity.equals(o))){t&&console.log("Expression reduces to identity.");break label126}a=!0}if(0===h)break}this.primeImplicants=[];for(var d=this.levelTerms[n].slice().reverse();d.length;)this.primeImplicants.push(new PrimeImplicant(d.pop()));for(var f=0;f<this.numMinterms;++f){for(var m=this.levelTerms[0][f],p=this.primeImplicants.slice().reverse();p.length;){var g=p.pop();g.covers(m)&&(m.incrementCoverCount(),g.addCover(m))}if(0===m.getCoverCount())throw"Minterm "+this.reverseBits(m.value,this.numVars)+" is not covered by any prime implicants.";t&&console.log("Minterm "+this.reverseBits(m.value,this.numVars)+" is covered by "+m.getCoverCount()+" prime implicant"+(1!==m.getCoverCount()?"s.":"."))}this.primeImplicants.sort((t,e)=>t.compareTo(e));var v=this.levelTerms[0].slice();v.sort((t,e)=>t.compareTo(e));var b=this.primeImplicants.slice();for(this.minimum=[];v.length>0;)for(var y=v[0],I=0;I<b.length;++I){var N=b[I];if(N.covers(y)){for(this.minimum.push(N),d=N.coversArray.slice().reverse();d.length;){var T=d.pop();v=v.filter(t=>!t.equals(T))}b=b.filter(t=>!t.equals(N))}}}toString(){if(0===this.minimum.length)return"0";for(var t="",e=0;e<this.minimum.length;++e)t+=this.minimum[e].ptString(),e<this.minimum.length-1&&(t+=" OR ");return new String(t)}}